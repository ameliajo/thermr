#define CATCH_CONFIG_MAIN
#include "catch.hpp"
#include "coh/coh.h"
#include "generalTools/testing.h"


TEST_CASE( "coh" ){
  GIVEN( "material is graphite (lat = 1)" ){
    WHEN( "" ){
      double temp = 296.0, emax = 0.625;
      int lat = 1, numAtoms = 1;
      double tol = 5e-2;
      std::vector<double> eGrid;
      eGrid = { 1.00E-5, 1.0625E-5, 1.1250E-5, 1.1875E-5, 1.25E-5, 1.3750E-5, 1.50E-5, 1.6250E-5, 1.75E-5, 1.8750E-5, 2.00E-5, 2.1875E-5, 2.3750E-5, 2.5625E-5, 2.75E-5, 2.9375E-5, 3.1250E-5, 3.3125E-5, 3.50E-5, 3.8750E-5, 4.25E-5, 4.6250E-5, 5.00E-5, 5.3125E-5, 5.6250E-5, 5.9375E-5, 6.25E-5, 6.8750E-5, 7.50E-5, 8.1250E-5, 8.75E-5, 9.3750E-5, 1.00E-4, 1.0625E-4, 1.1250E-4, 1.1875E-4, 1.25E-4, 1.3750E-4, 1.50E-4, 1.6250E-4, 1.75E-4, 1.8750E-4, 2.00E-4, 2.1875E-4, 2.3750E-4, 2.5625E-4, 2.75E-4, 2.9375E-4, 3.1250E-4, 3.3125E-4, 3.50E-4, 3.8750E-4, 4.25E-4, 4.6250E-4, 5.00E-4, 5.3125E-4, 5.6250E-4, 5.9375E-4, 6.25E-4, 6.8750E-4, 7.50E-4, 8.1250E-4, 8.75E-4, 9.3750E-4, 1.00E-3, 1.0625E-3, 1.1250E-3, 1.1875E-3, 1.25E-3, 1.3750E-3, 1.50E-3, 1.6250E-3, 1.75E-3, 1.8750E-3, 2.00E-3, 2.1875E-3, 2.3750E-3, 2.5625E-3, 2.75E-3, 2.9375E-3, 3.1250E-3, 3.3125E-3, 3.50E-3, 3.8750E-3, 4.25E-3, 4.6250E-3, 5.00E-3, 5.3125E-3, 5.6250E-3, 5.9375E-3, 6.25E-3, 6.8750E-3, 7.50E-3, 8.1250E-3, 8.75E-3, 9.3750E-3, 1.00E-2, 1.0625E-2, 1.1250E-2, 1.1875E-2, 1.25E-2, 1.3750E-2, 1.50E-2, 1.6250E-2, 1.75E-2, 1.8750E-2, 2.00E-2, 2.1325E-2, 2.2650E-2, 2.3975E-2, 2.53E-2, 2.684375E-2, 2.838750E-2, 3.1475E-2, 3.456250E-2, 3.7650E-2, 4.073750E-2, 4.3825E-2, 4.691250E-2, 5.00E-2, 5.3125E-2, 5.6250E-2, 5.9375E-2, 6.25E-2, 6.8750E-2, 7.50E-2, 8.1250E-2, 8.75E-2, 9.3750E-2, 1.00E-1, 1.0625E-1, 1.1250E-1, 1.1875E-1, 1.25E-1, 1.3750E-1, 1.50E-1, 1.6250E-1, 1.75E-1, 1.8750E-1, 2.00E-1, 2.1875E-1, 2.3750E-1, 2.5625E-1, 2.75E-1, 2.9375E-1, 3.1250E-1, 3.3125E-1, 3.50E-1, 3.8750E-1, 4.25E-1, 5.00E-1, 6.25E-1, 7.50E-1, 8.75E-1, 1.00E0, 1.25E0, 1.50E0, 1.75E0, 2.00E0, 2.3750E0, 2.75E0, 3.1250E0, 3.50E0, 4.25E0, 5.00E0, 6.25E0, 7.50E0, 8.75E0, 1.00E1, 1.25E1, 1.50E1, 1.75E1, 2.00E1, 2.3750E1, 2.75E1, 3.1250E1, 3.50E1, 4.25E1, 5.00E1, 6.25E1, 7.50E1, 8.75E1, 1.00E2, 1.25E2, 1.50E2, 1.75E2, 2.00E2, 2.3750E2, 2.75E2, 3.1250E2, 3.50E2, 4.25E2, 5.00E2, 6.25E2, 7.50E2, 8.75E2, 1.00E3, 1.25E3, 1.50E3, 1.75E3, 2.00E3, 2.25E3, 2.50E3, 2.75E3, 3.00E3, 3.25E3, 3.50E3, 4.00E3, 4.50E3, 5.00E3, 5.50E3, 6.00E3, 6.50E3, 7.00E3, 8.00E3, 9.00E3, 1.00E4, 1.1250E4, 1.25E4, 1.50E4, 1.75E4, 2.00E4, 2.25E4, 2.50E4, 2.75E4, 3.00E4, 3.25E4, 3.50E4, 4.00E4, 4.50E4, 5.00E4, 5.50E4, 6.00E4, 6.50E4, 7.00E4, 7.50E4, 8.00E4, 8.50E4, 9.00E4, 9.50E4, 1.00E5, 1.10E5, 1.20E5, 1.30E5, 1.40E5, 1.50E5, 1.60E5, 1.70E5, 1.80E5, 1.90E5, 2.00E5, 2.20E5, 2.40E5, 2.60E5, 2.80E5, 3.00E5, 3.20E5, 3.40E5, 3.60E5, 3.80E5, 4.00E5, 4.20E5, 4.40E5, 4.60E5, 4.80E5, 5.00E5, 5.50E5, 6.00E5, 6.50E5, 7.00E5, 7.50E5, 8.00E5, 8.50E5, 9.00E5, 9.50E5, 1.00E6, 1.10E6, 1.20E6, 1.30E6, 1.40E6, 1.50E6, 1.60E6, 1.70E6, 1.80E6, 1.90E6, 2.00E6, 2.20E6, 2.40E6, 2.60E6, 2.80E6, 3.00E6, 3.20E6, 3.40E6, 3.60E6, 3.80E6, 4.00E6, 4.20E6, 4.40E6, 4.60E6, 4.80E6, 5.00E6, 5.20E6, 5.40E6, 5.60E6, 5.80E6, 6.00E6, 6.20E6, 6.40E6, 6.60E6, 6.80E6, 7.00E6, 7.50E6, 8.00E6, 8.50E6, 9.00E6, 9.50E6, 1.00E7, 1.05E7, 1.10E7, 1.15E7, 1.20E7, 1.25E7, 1.30E7, 1.35E7, 1.40E7, 1.45E7, 1.50E7, 1.55E7, 1.60E7, 1.65E7, 1.70E7, 1.75E7, 1.80E7, 1.85E7, 1.90E7, 1.95E7, 2.00E7 };
      
      std::cout.precision(15);
     
      auto out = coh(temp,lat,emax,numAtoms,eGrid,tol);
      std::vector<double> finalE  = std::get<0>(out);
      std::vector<double> finalXS = std::get<1>(out);

      std::vector<double> correct_finalE { 1.000000E-5, 1.062500E-5, 1.125000E-5, 
      1.187500E-5, 1.250000E-5, 1.375000E-5, 1.500000E-5, 1.625000E-5, 1.750000E-5, 
      1.875000E-5, 2.000000E-5, 2.187500E-5, 2.375000E-5, 2.562500E-5, 2.750000E-5, 
      2.937500E-5, 3.125000E-5, 3.312500E-5, 3.500000E-5, 3.875000E-5, 4.250000E-5, 
      4.625000E-5, 5.000000E-5, 5.312500E-5, 5.625000E-5, 5.937500E-5, 6.250000E-5, 
      6.875000E-5, 7.500000E-5, 8.125000E-5, 8.750000E-5, 9.375000E-5, 1.000000E-4, 
      1.062500E-4, 1.125000E-4, 1.187500E-4, 1.250000E-4, 1.375000E-4, 1.500000E-4, 
      1.625000E-4, 1.750000E-4, 1.875000E-4, 2.000000E-4, 2.187500E-4, 2.375000E-4, 
      2.562500E-4, 2.750000E-4, 2.937500E-4, 3.125000E-4, 3.312500E-4, 3.500000E-4, 
      3.875000E-4, 4.250000E-4, 4.555814E-4, 4.555816E-4, 4.625000E-4, 5.000000E-4, 
      5.312500E-4, 5.625000E-4, 5.937500E-4, 6.250000E-4, 6.875000E-4, 7.500000E-4, 
      8.125000E-4, 8.750000E-4, 9.375000E-4, 1.000000E-3, 1.062500E-3, 1.125000E-3, 
      1.187500E-3, 1.250000E-3, 1.375000E-3, 1.500000E-3, 1.625000E-3, 1.750000E-3, 
      1.822325E-3, 1.822327E-3, 1.875000E-3, 2.000000E-3, 2.187500E-3, 2.375000E-3, 
      2.562500E-3, 2.750000E-3, 2.937500E-3, 3.125000E-3, 3.312500E-3, 3.500000E-3, 
      3.875000E-3, 4.100232E-3, 4.100234E-3, 4.250000E-3, 4.515834E-3, 4.515836E-3, 
      4.625000E-3, 4.971415E-3, 4.971417E-3, 5.000000E-3, 5.312500E-3, 5.625000E-3, 
      5.937500E-3, 6.250000E-3, 6.338160E-3, 6.338162E-3, 6.875000E-3, 7.289303E-3, 
      7.289305E-3, 7.500000E-3, 8.125000E-3, 8.616067E-3, 8.616069E-3, 8.750000E-3, 
      9.375000E-3, 1.000000E-2, 1.062500E-2, 1.125000E-2, 1.138953E-2, 1.138955E-2, 
      1.180513E-2, 1.180515E-2, 1.187500E-2, 1.250000E-2, 1.354749E-2, 1.354751E-2, 
      1.375000E-2, 1.400308E-2, 1.400310E-2, 1.500000E-2, 1.536982E-2, 1.536984E-2, 
      1.590536E-2, 1.590538E-2, 1.625000E-2, 1.640092E-2, 1.640094E-2, 1.750000E-2, 
      1.764773E-2, 1.764775E-2, 1.806333E-2, 1.806335E-2, 1.851891E-2, 1.851893E-2, 
      1.875000E-2, 1.988565E-2, 1.988567E-2, 2.000000E-2, 2.083680E-2, 2.083682E-2, 
      2.091676E-2, 2.091678E-2, 2.132500E-2, 2.216356E-2, 2.216358E-2, 2.232348E-2, 
      2.232350E-2, 2.265000E-2, 2.397500E-2, 2.493703E-2, 2.493705E-2, 2.530000E-2, 
      2.535263E-2, 2.535265E-2, 2.683932E-2, 2.683934E-2, 2.684375E-2, 2.838750E-2, 
      2.915720E-2, 2.915722E-2, 2.945287E-2, 2.945289E-2, 2.994843E-2, 2.994845E-2, 
      3.147500E-2, 3.161083E-2, 3.161085E-2, 3.206641E-2, 3.206643E-2, 3.343316E-2, 
      3.343318E-2, 3.367304E-2, 3.367306E-2, 3.446426E-2, 3.446428E-2, 3.456250E-2, 
      3.571107E-2, 3.571109E-2, 3.587099E-2, 3.587101E-2, 3.690209E-2, 3.690211E-2, 
      3.765000E-2, 3.890014E-2, 3.890016E-2, 4.038682E-2, 4.038684E-2, 4.064250E-2, 
      4.064252E-2, 4.073750E-2, 4.109808E-2, 4.109810E-2, 4.141792E-2, 4.141794E-2, 
      4.246483E-2, 4.246485E-2, 4.270471E-2, 4.270473E-2, 4.300037E-2, 4.300039E-2, 
      4.382500E-2, 4.474274E-2, 4.474276E-2, 4.555814E-2, 4.555816E-2, 4.691250E-2, 
      4.722054E-2, 4.722056E-2, 4.793181E-2, 4.793183E-2, 4.801177E-2, 4.801179E-2, 
      5.000000E-2, 5.007397E-2, 5.007399E-2, 5.312500E-2, 5.393433E-2, 5.393435E-2, 
      5.496543E-2, 5.496545E-2, 5.512535E-2, 5.512537E-2, 5.625000E-2, 5.829024E-2, 
      5.829026E-2, 5.870584E-2, 5.870586E-2, 5.910564E-2, 5.910566E-2, 5.937500E-2, 
      5.964118E-2, 5.964120E-2, 6.250000E-2, 6.280607E-2, 6.280609E-2, 6.296599E-2, 
      6.296601E-2, 6.362148E-2, 6.362150E-2, 6.560372E-2, 6.560374E-2, 6.875000E-2, 
      6.979972E-2, 6.979974E-2, 7.011956E-2, 7.011958E-2, 7.407567E-2, 7.407569E-2, 
      7.500000E-2, 7.699326E-2, 7.699328E-2, 8.102933E-2, 8.102935E-2, 8.125000E-2, 
      8.150909E-2, 8.150911E-2, 8.580085E-2, 8.580087E-2, 8.620065E-2, 8.620067E-2, 
      8.750000E-2, 8.929396E-2, 8.929398E-2, 9.375000E-2, 9.380979E-2, 9.380981E-2, 
      9.893275E-2, 9.893277E-2, 1.000000E-1, 1.014105E-1, 1.014107E-1, 1.025057E-1, 
      1.025059E-1, 1.062500E-1, 1.081243E-1, 1.081245E-1, 1.086040E-1, 1.086042E-1, 
      1.091554E-1, 1.091556E-1, 1.125000E-1, 1.147181E-1, 1.147183E-1, 1.166288E-1, 
      1.166290E-1, 1.187500E-1, 1.227029E-1, 1.227031E-1, 1.239896E-1, 1.239898E-1, 
      1.242853E-1, 1.242855E-1, 1.250000E-1, 1.273786E-1, 1.273788E-1, 1.299364E-1, 
      1.299366E-1, 1.316629E-1, 1.316631E-1, 1.375000E-1, 1.383284E-1, 1.383286E-1, 
      1.399908E-1, 1.399910E-1, 1.403906E-1, 1.403908E-1, 1.420530E-1, 1.420532E-1, 
      1.431482E-1, 1.431484E-1, 1.476083E-1, 1.476085E-1, 1.500000E-1, 1.556005E-1, 
      1.556007E-1, 1.563917E-1, 1.563919E-1, 1.572713E-1, 1.572715E-1, 1.625000E-1, 
      1.644648E-1, 1.644650E-1, 1.739595E-1, 1.739597E-1, 1.747591E-1, 1.747593E-1, 
      1.750000E-1, 1.822325E-1, 1.822327E-1, 1.875000E-1, 1.917272E-1, 1.917274E-1, 
      2.000000E-1, 2.002958E-1, 2.002960E-1, 2.009113E-1, 2.009115E-1, 2.112214E-1, 
      2.112216E-1, 2.114613E-1, 2.114615E-1, 2.138433E-1, 2.138435E-1, 2.144588E-1, 
      2.144590E-1, 2.154016E-1, 2.154018E-1, 2.187500E-1, 2.189747E-1, 2.189749E-1, 
      2.205013E-1, 2.205015E-1, 2.325222E-1, 2.325224E-1, 2.326653E-1, 2.326655E-1, 
      2.367182E-1, 2.367184E-1, 2.375000E-1, 2.385647E-1, 2.385649E-1, 2.410025E-1, 
      2.410027E-1, 2.531107E-1, 2.531109E-1, 2.544858E-1, 2.544860E-1, 2.562500E-1, 
      2.590658E-1, 2.590660E-1, 2.624148E-1, 2.624150E-1, 2.750000E-1, 2.759214E-1, 
      2.759216E-1, 2.759623E-1, 2.759625E-1, 2.764012E-1, 2.764014E-1, 2.773607E-1, 
      2.773609E-1, 2.804782E-1, 2.804784E-1, 2.847383E-1, 2.847385E-1, 2.937500E-1, 
      2.997084E-1, 2.997086E-1, 3.004029E-1, 3.004031E-1, 3.028017E-1, 3.028019E-1, 
      3.079730E-1, 3.079732E-1, 3.125000E-1, 3.237259E-1, 3.237261E-1, 3.237816E-1, 
      3.237818E-1, 3.253808E-1, 3.253810E-1, 3.260363E-1, 3.260365E-1, 3.312500E-1, 
      3.321188E-1, 3.321190E-1, 3.493184E-1, 3.493186E-1, 3.500000E-1, 3.501821E-1, 
      3.501823E-1, 3.571758E-1, 3.571760E-1, 3.752140E-1, 3.752142E-1, 3.752391E-1, 
      3.752393E-1, 3.831439E-1, 3.831441E-1, 3.875000E-1, 4.023090E-1, 4.023092E-1, 
      4.024057E-1, 4.024059E-1, 4.026846E-1, 4.026848E-1, 4.035084E-1, 4.035086E-1, 
      4.035725E-1, 4.035727E-1, 4.043722E-1, 4.043724E-1, 4.100232E-1, 4.100234E-1, 
      4.250000E-1, 4.313621E-1, 4.313623E-1, 4.313862E-1, 4.313864E-1, 4.366217E-1, 
      4.366219E-1, 4.378137E-1, 4.378139E-1, 4.598322E-1, 4.598324E-1, 4.603594E-1, 
      4.603596E-1, 4.608559E-1, 4.608561E-1, 4.613189E-1, 4.613191E-1, 4.622784E-1, 
      4.622786E-1, 4.665153E-1, 4.665155E-1, 4.899248E-1, 4.899250E-1, 4.946888E-1, 
      4.946890E-1, 4.960398E-1, 4.960400E-1, 4.961281E-1, 4.961283E-1, 5.000000E-1, 
      5.212158E-1, 5.212160E-1, 5.229191E-1, 5.229193E-1, 5.266521E-1, 5.266523E-1, 
      5.533138E-1, 5.533140E-1, 5.533947E-1, 5.533949E-1, 5.580872E-1, 5.580874E-1, 
      5.861408E-1, 5.861410E-1, 5.862839E-1, 5.862841E-1, 5.904335E-1, 5.904337E-1, 
      6.202685E-1, 6.202687E-1, 6.203326E-1, 6.203328E-1, 6.211322E-1, 6.211324E-1, 
      6.236909E-1, 6.236911E-1, 6.249999E-1, 6.250000E-1, 6.250001E-1, 2.000000E+7 };
      std::vector<double> correct_finalXS { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 7.393697, 7.185991, 6.736867, 
      6.159421, 5.673151, 5.258042, 4.899540, 4.586803, 4.311595, 4.067542, 
      3.849638, 3.477093, 3.286091, 3.286089, 3.170290, 2.983665, 3.330651, 
      3.252037, 3.025431, 4.820561, 4.793004, 4.511062, 4.260448, 4.036214, 
      3.834403, 3.781069, 4.191728, 3.864414, 3.644772, 4.525214, 4.398089, 
      4.059774, 3.828390, 4.590127, 4.519869, 4.218544, 3.954885, 3.722245, 
      3.515454, 3.472387, 3.472381, 3.350141, 3.504040, 3.483429, 3.309257, 
      3.053386, 4.039530, 3.980042, 3.908110, 3.908104, 3.648372, 3.560587, 
      5.166540, 4.992587, 5.277262, 5.165345, 5.117814, 5.358416, 5.021889, 
      4.979850, 4.979845, 4.865274, 4.903729, 4.783099, 5.004494, 4.942820, 
      4.660540, 4.726060, 4.699044, 4.510331, 5.479543, 5.458601, 5.518782, 
      5.413137, 5.208331, 5.372044, 5.333564, 5.333560, 5.256676, 4.966161, 
      4.774575, 4.774571, 4.706076, 4.696306, 4.739664, 4.477127, 4.594987, 
      4.594232, 4.344391, 4.229707, 4.320346, 4.276978, 4.377152, 4.304726, 
      4.823510, 4.589567, 4.569846, 4.599306, 4.533965, 4.706284, 4.513894, 
      4.567196, 4.534662, 4.560972, 4.456265, 4.481495, 4.468760, 4.325032, 
      4.466990, 4.447077, 4.447075, 4.322819, 4.322817, 4.236947, 4.100784, 
      4.141242, 3.988801, 4.045418, 4.019970, 4.169190, 4.159470, 4.122976, 
      4.122974, 4.091137, 4.145156, 4.042965, 4.317921, 4.293668, 4.565730, 
      4.534340, 4.635047, 4.547834, 4.454551, 4.454549, 4.374823, 4.414944, 
      4.287487, 4.259517, 4.273565, 4.210151, 4.428574, 4.421201, 4.448415, 
      4.271527, 4.265217, 4.277760, 4.032085, 3.971580, 4.122992, 4.045650, 
      4.076981, 4.065155, 4.389257, 4.301500, 4.150942, 4.150941, 4.121556, 
      4.130708, 4.102768, 4.301339, 4.281827, 4.262717, 4.461601, 4.257524, 
      4.236776, 4.284631, 4.273751, 4.273749, 4.229718, 4.237484, 4.109448, 
      4.185064, 3.993540, 3.933481, 4.074058, 4.055476, 4.201846, 3.977442, 
      4.010480, 3.961055, 3.858508, 3.954036, 3.757086, 3.784866, 3.774587, 
      3.762589, 3.865139, 3.671805, 3.675877, 3.658830, 3.791125, 3.734829, 
      3.659794, 3.698877, 3.523066, 3.520821, 3.742820, 3.549009, 3.595325, 
      3.556955, 3.507482, 3.603147, 3.564657, 3.663723, 3.534618, 3.473347, 
      3.487511, 3.472114, 3.486124, 3.468520, 3.567883, 3.461817, 3.394882, 
      3.400978, 3.345267, 3.415814, 3.354804, 3.246728, 3.284118, 3.250042, 
      3.303500, 3.295645, 3.315189, 3.296239, 3.234687, 3.268284, 3.203953, 
      3.262846, 3.220065, 3.258012, 3.119709, 3.101026, 3.120996, 3.083939, 
      3.085142, 3.076361, 3.131409, 3.094767, 3.098222, 3.074522, 3.101520, 
      3.007810, 3.055013, 3.006306, 2.898100, 2.899892, 2.885225, 2.886991, 
      2.870848, 2.970384, 2.874810, 2.840466, 2.893839, 2.735897, 2.737178, 
      2.724657, 2.781143, 2.777317, 2.667090, 2.736199, 2.659333, 2.600700, 
      2.644805, 2.535408, 2.531663, 2.532074, 2.524320, 2.563040, 2.437936, 
      2.443477, 2.440707, 2.452431, 2.425115, 2.425778, 2.418818, 2.418816, 
      2.408231, 2.423140, 2.386052, 2.383603, 2.384824, 2.368315, 2.407972, 
      2.283487, 2.284975, 2.283572, 2.300597, 2.261210, 2.266250, 2.258792, 
      2.248711, 2.251178, 2.228408, 2.260182, 2.152062, 2.152060, 2.140434, 
      2.147688, 2.132904, 2.109721, 2.122227, 2.095144, 2.120917, 2.023856, 
      2.017098, 2.017881, 2.017583, 2.019671, 2.016466, 2.022014, 2.015020, 
      2.018661, 1.996225, 2.000857, 1.970922, 1.992775, 1.931642, 1.893240, 
      1.893799, 1.889422, 1.892922, 1.877927, 1.887473, 1.855781, 1.871175, 
      1.844070, 1.780122, 1.782274, 1.781969, 1.783106, 1.774343, 1.774931, 
      1.771364, 1.775630, 1.747684, 1.743112, 1.754724, 1.668327, 1.669940, 
      1.666689, 1.665822, 1.668468, 1.635800, 1.648990, 1.569717, 1.569784, 
      1.569680, 1.573489, 1.541027, 1.548904, 1.531493, 1.475118, 1.475166, 
      1.474812, 1.474860, 1.473839, 1.474607, 1.471598, 1.471668, 1.471435, 
      1.471813, 1.468903, 1.471065, 1.450792, 1.457261, 1.405908, 1.385173, 
      1.385172, 1.385095, 1.387165, 1.370533, 1.370798, 1.367067, 1.371783, 
      1.306097, 1.306120, 1.304625, 1.304695, 1.303290, 1.303290, 1.301982, 
      1.302052, 1.299350, 1.300237, 1.288429, 1.292487, 1.230730, 1.230955, 
      1.219101, 1.219503, 1.216182, 1.216204, 1.215988, 1.219432, 1.209989, 
      1.160738, 1.160794, 1.157013, 1.157250, 1.149048, 1.151478, 1.095994, 
      1.096056, 1.095896, 1.096147, 1.086931, 1.088681, 1.036575, 1.036661, 
      1.036408, 1.036618, 1.029333, 1.030624, 0.9810508, 0.9810541, 0.9809531, 
      0.9809528, 0.9796903, 0.9797975, 0.9757782, 0.9757884, 0.9737450, 0.9737449, 
      0.0, 0.0 };

      //std::cout.precision(15);
      REQUIRE( ranges::equal(finalE,correct_finalE,equal) );
      REQUIRE( ranges::equal(finalXS,correct_finalXS,equal) );
      
    } // WHEN
  } // GIVEN

  GIVEN( "material is beryllium (lat = 2)" ){
    WHEN( "" ){
      double temp = 296.0, emax = 1.025;
      int lat = 2, numAtoms = 1;
      double tol = 5e-2;
      std::vector<double> eGrid;
      eGrid = { 1.00E-5, 1.0625E-5, 1.1250E-5, 1.1875E-5, 1.25E-5, 1.3750E-5, 1.50E-5, 1.6250E-5, 1.75E-5, 1.8750E-5, 2.00E-5, 2.1875E-5, 2.3750E-5, 2.5625E-5, 2.75E-5, 2.9375E-5, 3.1250E-5, 3.3125E-5, 3.50E-5, 3.8750E-5, 4.25E-5, 4.6250E-5, 5.00E-5, 5.3125E-5, 5.6250E-5, 5.9375E-5, 6.25E-5, 6.8750E-5, 7.50E-5, 8.1250E-5, 8.75E-5, 9.3750E-5, 1.00E-4, 1.0625E-4, 1.1250E-4, 1.1875E-4, 1.25E-4, 1.3750E-4, 1.50E-4, 1.6250E-4, 1.75E-4, 1.8750E-4, 2.00E-4, 2.1875E-4, 2.3750E-4, 2.5625E-4, 2.75E-4, 2.9375E-4, 3.1250E-4, 3.3125E-4, 3.50E-4, 3.8750E-4, 4.25E-4, 4.6250E-4, 5.00E-4, 5.3125E-4, 5.6250E-4, 5.9375E-4, 6.25E-4, 6.8750E-4, 7.50E-4, 8.1250E-4, 8.75E-4, 9.3750E-4, 1.00E-3, 1.0625E-3, 1.1250E-3, 1.1875E-3, 1.25E-3, 1.3750E-3, 1.50E-3, 1.6250E-3, 1.75E-3, 1.8750E-3, 2.00E-3, 2.1875E-3, 2.3750E-3, 2.5625E-3, 2.75E-3, 2.9375E-3, 3.1250E-3, 3.3125E-3, 3.50E-3, 3.8750E-3, 4.25E-3, 4.6250E-3, 5.00E-3, 5.3125E-3, 5.6250E-3, 5.9375E-3, 6.25E-3, 6.8750E-3, 7.50E-3, 8.1250E-3, 8.75E-3, 9.3750E-3, 1.00E-2, 1.0625E-2, 1.1250E-2, 1.1875E-2, 1.25E-2, 1.3750E-2, 1.50E-2, 1.6250E-2, 1.75E-2, 1.8750E-2, 2.00E-2, 2.1325E-2, 2.2650E-2, 2.3975E-2, 2.53E-2, 2.684375E-2, 2.838750E-2, 3.1475E-2, 3.456250E-2, 3.7650E-2, 4.073750E-2, 4.3825E-2, 4.691250E-2, 5.00E-2, 5.3125E-2, 5.6250E-2, 5.9375E-2, 6.25E-2, 6.8750E-2, 7.50E-2, 8.1250E-2, 8.75E-2, 9.3750E-2, 1.00E-1, 1.0625E-1, 1.1250E-1, 1.1875E-1, 1.25E-1, 1.3750E-1, 1.50E-1, 1.6250E-1, 1.75E-1, 1.8750E-1, 2.00E-1, 2.1875E-1, 2.3750E-1, 2.5625E-1, 2.75E-1, 2.9375E-1, 3.1250E-1, 3.3125E-1, 3.50E-1, 3.8750E-1, 4.25E-1, 5.00E-1, 6.25E-1, 7.50E-1, 8.75E-1, 1.00E0, 1.25E0, 1.50E0, 1.75E0, 2.00E0, 2.3750E0, 2.75E0, 3.1250E0, 3.50E0, 4.25E0, 5.00E0, 6.25E0, 7.50E0, 8.75E0, 1.00E1, 1.25E1, 1.50E1, 1.75E1, 2.00E1, 2.3750E1, 2.75E1, 3.1250E1, 3.50E1, 4.25E1, 5.00E1, 6.25E1, 7.50E1, 8.75E1, 1.00E2, 1.25E2, 1.50E2, 1.75E2, 2.00E2, 2.3750E2, 2.75E2, 3.1250E2, 3.50E2, 4.25E2, 5.00E2, 6.25E2, 7.50E2, 8.75E2, 1.00E3, 1.25E3, 1.50E3, 1.75E3, 2.00E3, 2.25E3, 2.50E3, 2.75E3, 3.00E3, 3.25E3, 3.50E3, 4.00E3, 4.50E3, 5.00E3, 5.50E3, 6.00E3, 6.50E3, 7.00E3, 8.00E3, 9.00E3, 1.00E4, 1.1250E4, 1.25E4, 1.50E4, 1.75E4, 2.00E4, 2.25E4, 2.50E4, 2.75E4, 3.00E4, 3.25E4, 3.50E4, 4.00E4, 4.50E4, 5.00E4, 5.50E4, 6.00E4, 6.50E4, 7.00E4, 7.50E4, 8.00E4, 8.50E4, 9.00E4, 9.50E4, 1.00E5, 1.10E5, 1.20E5, 1.30E5, 1.40E5, 1.50E5, 1.60E5, 1.70E5, 1.80E5, 1.90E5, 2.00E5, 2.20E5, 2.40E5, 2.60E5, 2.80E5, 3.00E5, 3.20E5, 3.40E5, 3.60E5, 3.80E5, 4.00E5, 4.20E5, 4.40E5, 4.60E5, 4.80E5, 5.00E5, 5.50E5, 6.00E5, 6.50E5, 7.00E5, 7.50E5, 8.00E5, 8.50E5, 9.00E5, 9.50E5, 1.00E6, 1.10E6, 1.20E6, 1.30E6, 1.40E6, 1.50E6, 1.60E6, 1.70E6, 1.80E6, 1.90E6, 2.00E6, 2.20E6, 2.40E6, 2.60E6, 2.80E6, 3.00E6, 3.20E6, 3.40E6, 3.60E6, 3.80E6, 4.00E6, 4.20E6, 4.40E6, 4.60E6, 4.80E6, 5.00E6, 5.20E6, 5.40E6, 5.60E6, 5.80E6, 6.00E6, 6.20E6, 6.40E6, 6.60E6, 6.80E6, 7.00E6, 7.50E6, 8.00E6, 8.50E6, 9.00E6, 9.50E6, 1.00E7, 1.05E7, 1.10E7, 1.15E7, 1.20E7, 1.25E7, 1.30E7, 1.35E7, 1.40E7, 1.45E7, 1.50E7, 1.55E7, 1.60E7, 1.65E7, 1.70E7, 1.75E7, 1.80E7, 1.85E7, 1.90E7, 1.95E7, 2.00E7 };
      /*{ 1.0000E-5, 1.0625E-5, 1.1250E-5, 1.1875E-5, 1.2500E-5, 1.3750E-5, 
        1.5000E-5, 1.6250E-5, 1.7500E-5, 1.8750E-5, 2.0000E-5, 2.1875E-5, 
        2.3750E-5, 2.5625E-5, 2.7500E-5, 2.9375E-5, 3.1250E-5, 3.3125E-5, 
        3.5000E-5, 3.8750E-5, 4.2500E-5, 4.6250E-5, 5.0000E-5, 5.3125E-5, 
        5.6250E-5, 5.9375E-5, 6.2500E-5, 6.8750E-5, 7.5000E-5, 8.1250E-5, 
        8.7500E-5, 9.3750E-5, 1.0000E-4, 1.0625E-4, 1.1250E-4, 1.1875E-4, 
        1.2500E-4, 1.3750E-4, 1.5000E-4, 1.6250E-4, 1.7500E-4, 1.8750E-4, 
        2.0000E-4, 2.1875E-4, 2.3750E-4, 2.5625E-4, 2.7500E-4, 2.9375E-4, 
        3.1250E-4, 3.3125E-4, 3.5000E-4, 3.8750E-4, 4.2500E-4, 4.6250E-4, 
        5.0000E-4, 5.3125E-4, 5.6250E-4, 5.9375E-4, 6.2500E-4, 6.8750E-4, 
        7.5000E-4, 8.1250E-4, 8.7500E-4, 9.3750E-4, 1.0000E-3, 1.0625E-3, 
        1.1250E-3, 1.1875E-3, 1.2500E-3, 1.3750E-3, 1.5000E-3, 1.6250E-3, 
        1.7500E-3, 1.8750E-3, 2.0000E-3, 2.1875E-3, 2.3750E-3, 2.5625E-3, 
        2.7500E-3, 2.9375E-3, 3.1250E-3, 3.3125E-3, 3.5000E-3, 3.8750E-3, 
        4.2500E-3, 4.6250E-3, 5.0000E-3, 5.3125E-3, 5.6250E-3, 5.9375E-3, 
        6.2500E-3, 6.8750E-3, 7.5000E-3, 8.1250E-3, 8.7500E-3, 9.3750E-3, 
        1.0000E-2, 1.0625E-2, 1.1250E-2, 1.1875E-2, 1.2500E-2, 1.3750E-2, 
        1.5000E-2, 1.6250E-2, 1.7500E-2, 1.8750E-2, 2.0000E-2, 2.1325E-2, 
        2.2650E-2, 2.3975E-2, 2.5300E-2, 2.684375E-2, 2.838750E-2, 3.1475E-2, 
        3.45625E-2,3.7650E-2, 4.07375E-2, 4.3825E-2, 4.691250E-2, 5.0000E-2, 
        5.3125E-2, 5.6250E-2, 5.9375E-2, 6.2500E-2, 6.8750E-2, 7.5000E-2, 
        8.1250E-2, 8.7500E-2, 9.3750E-2, 1.0000E-1, 1.0625E-1, 1.1250E-1, 
        1.1875E-1, 1.2500E-1, 1.3750E-1, 1.5000E-1, 1.6250E-1, 1.7500E-1, 
        1.8750E-1, 2.0000E-1, 2.1875E-1, 2.3750E-1, 2.5625E-1, 2.7500E-1, 
        2.9375E-1, 3.1250E-1, 3.3125E-1, 3.5000E-1, 3.8750E-1, 4.2500E-1, 
        5.0000E-1, 6.2500E-1, 6.250062E-1 };
       */ 
      std::cout.precision(15);
      auto out = coh(temp,lat,emax,numAtoms,eGrid,tol);
      std::vector<double> finalE  = std::get<0>(out);
      std::vector<double> finalXS = std::get<1>(out);


      std::cout.precision(15);

      std::vector<double> correct_finalE { 1.000000E-5, 1.062500E-5, 1.125000E-5, 1.187500E-5, 1.250000E-5, 1.375000E-5, 1.500000E-5, 1.625000E-5, 1.750000E-5, 1.875000E-5, 2.000000E-5, 2.187500E-5, 2.375000E-5, 2.562500E-5, 2.750000E-5, 2.937500E-5, 3.125000E-5, 3.312500E-5, 3.500000E-5, 3.875000E-5, 4.250000E-5, 4.625000E-5, 5.000000E-5, 5.312500E-5, 5.625000E-5, 5.937500E-5, 6.250000E-5, 6.875000E-5, 7.500000E-5, 8.125000E-5, 8.750000E-5, 9.375000E-5, 1.000000E-4, 1.062500E-4, 1.125000E-4, 1.187500E-4, 1.250000E-4, 1.375000E-4, 1.500000E-4, 1.625000E-4, 1.750000E-4, 1.875000E-4, 2.000000E-4, 2.187500E-4, 2.375000E-4, 2.562500E-4, 2.750000E-4, 2.937500E-4, 3.125000E-4, 3.312500E-4, 3.500000E-4, 3.875000E-4, 4.250000E-4, 4.625000E-4, 5.000000E-4, 5.312500E-4, 5.625000E-4, 5.937500E-4, 6.250000E-4, 6.875000E-4, 7.500000E-4, 8.125000E-4, 8.750000E-4, 9.375000E-4, 1.000000E-3, 1.062500E-3, 1.125000E-3, 1.187500E-3, 1.250000E-3, 1.375000E-3, 1.500000E-3, 1.592844E-3, 1.592846E-3, 1.625000E-3, 1.750000E-3, 1.875000E-3, 2.000000E-3, 2.187500E-3, 2.375000E-3, 2.562500E-3, 2.750000E-3, 2.937500E-3, 3.125000E-3, 3.312500E-3, 3.500000E-3, 3.875000E-3, 4.250000E-3, 4.625000E-3, 5.000000E-3, 5.219800E-3, 5.219802E-3, 5.312500E-3, 5.625000E-3, 5.937500E-3, 6.250000E-3, 6.371380E-3, 6.371382E-3, 6.812645E-3, 6.812647E-3, 6.875000E-3, 7.500000E-3, 8.125000E-3, 8.750000E-3, 9.375000E-3, 1.000000E-2, 1.062500E-2, 1.125000E-2, 1.159117E-2, 1.159119E-2, 1.187500E-2, 1.250000E-2, 1.375000E-2, 1.433560E-2, 1.433562E-2, 1.500000E-2, 1.565939E-2, 1.565941E-2, 1.625000E-2, 1.725224E-2, 1.725226E-2, 1.750000E-2, 1.875000E-2, 1.955540E-2, 1.955542E-2, 2.000000E-2, 2.087919E-2, 2.087921E-2, 2.132500E-2, 2.203077E-2, 2.203079E-2, 2.247204E-2, 2.247206E-2, 2.265000E-2, 2.397500E-2, 2.530000E-2, 2.548551E-2, 2.548553E-2, 2.684375E-2, 2.725057E-2, 2.725059E-2, 2.838750E-2, 2.999500E-2, 2.999502E-2, 3.070531E-2, 3.070533E-2, 3.147500E-2, 3.456250E-2, 3.521480E-2, 3.521482E-2, 3.653860E-2, 3.653862E-2, 3.765000E-2, 3.813144E-2, 3.813146E-2, 3.982112E-2, 3.982114E-2, 4.073750E-2, 4.114492E-2, 4.114494E-2, 4.290998E-2, 4.291000E-2, 4.382500E-2, 4.504092E-2, 4.504094E-2, 4.636472E-2, 4.636474E-2, 4.691250E-2, 4.697820E-2, 4.697822E-2, 4.857104E-2, 4.857106E-2, 5.000000E-2, 5.312500E-2, 5.334958E-2, 5.334960E-2, 5.625000E-2, 5.734242E-2, 5.734244E-2, 5.937500E-2, 6.070032E-2, 6.070034E-2, 6.250000E-2, 6.256222E-2, 6.256224E-2, 6.785740E-2, 6.785742E-2, 6.875000E-2, 7.246372E-2, 7.246374E-2, 7.500000E-2, 7.635973E-2, 7.635975E-2, 7.804940E-2, 7.804942E-2, 8.125000E-2, 8.219301E-2, 8.219303E-2, 8.326920E-2, 8.326922E-2, 8.750000E-2, 8.812312E-2, 8.812314E-2, 8.988819E-2, 8.988821E-2, 9.375000E-2, 9.785241E-2, 9.785243E-2, 9.892861E-2, 9.892863E-2, 1.000000E-1, 1.019420E-1, 1.019422E-1, 1.062500E-1, 1.071618E-1, 1.071620E-1, 1.125000E-1, 1.135117E-1, 1.135119E-1, 1.145879E-1, 1.145881E-1, 1.176014E-1, 1.176016E-1, 1.187500E-1, 1.228212E-1, 1.228214E-1, 1.250000E-1, 1.290204E-1, 1.290206E-1, 1.368663E-1, 1.368665E-1, 1.375000E-1, 1.408591E-1, 1.408593E-1, 1.489202E-1, 1.489204E-1, 1.498996E-1, 1.498998E-1, 1.500000E-1, 1.592844E-1, 1.592846E-1, 1.625000E-1, 1.681851E-1, 1.681853E-1, 1.697994E-1, 1.697996E-1, 1.703161E-1, 1.703163E-1, 1.750000E-1, 1.759986E-1, 1.759988E-1, 1.801636E-1, 1.801638E-1, 1.875000E-1, 1.895056E-1, 1.895058E-1, 1.927342E-1, 1.927344E-1, 2.000000E-1, 2.034968E-1, 2.034970E-1, 2.062626E-1, 2.062628E-1, 2.136134E-1, 2.136136E-1, 2.187500E-1, 2.244513E-1, 2.244515E-1, 2.271418E-1, 2.271420E-1, 2.277339E-1, 2.277341E-1, 2.293696E-1, 2.293698E-1, 2.375000E-1, 2.428012E-1, 2.428014E-1, 2.502488E-1, 2.502490E-1, 2.562500E-1, 2.637558E-1, 2.637560E-1, 2.659082E-1, 2.659084E-1, 2.659621E-1, 2.659623E-1, 2.691907E-1, 2.691909E-1, 2.750000E-1, 2.848501E-1, 2.848503E-1, 2.897794E-1, 2.897796E-1, 2.900699E-1, 2.900701E-1, 2.937500E-1, 3.054388E-1, 3.054390E-1, 3.057293E-1, 3.057295E-1, 3.121976E-1, 3.121978E-1, 3.125000E-1, 3.278570E-1, 3.278572E-1, 3.312500E-1, 3.330768E-1, 3.330770E-1, 3.500000E-1, 3.513194E-1, 3.513196E-1, 3.527075E-1, 3.527077E-1, 3.583901E-1, 3.583903E-1, 3.788066E-1, 3.788068E-1, 3.792693E-1, 3.792695E-1, 3.875000E-1, 3.982976E-1, 3.982978E-1, 3.994706E-1, 3.994708E-1, 3.996858E-1, 3.996860E-1, 4.053683E-1, 4.053685E-1, 4.077683E-1, 4.077685E-1, 4.250000E-1, 4.286475E-1, 4.286477E-1, 4.516687E-1, 4.516689E-1, 4.538210E-1, 4.538212E-1, 4.547465E-1, 4.547467E-1, 4.603322E-1, 4.603324E-1, 4.851399E-1, 4.851401E-1, 4.888851E-1, 4.888853E-1, 4.912851E-1, 4.912853E-1, 5.000000E-1, 5.073104E-1, 5.073106E-1, 5.160817E-1, 5.160819E-1, 5.424608E-1, 5.424610E-1, 5.438490E-1, 5.438492E-1, 5.630599E-1, 5.630601E-1, 5.750170E-1, 5.750172E-1, 6.040222E-1, 6.040224E-1, 6.097262E-1, 6.097264E-1, 6.115556E-1, 6.115558E-1, 6.141603E-1, 6.141605E-1, 6.219952E-1, 6.219954E-1, 6.250000E-1, 6.371380E-1, 6.371382E-1, 6.692860E-1, 6.692862E-1, 6.709003E-1, 6.709005E-1, 6.714169E-1, 6.714171E-1, 6.812645E-1, 6.812647E-1, 6.841162E-1, 6.841164E-1, 7.024446E-1, 7.024448E-1, 7.386823E-1, 7.386825E-1, 7.389832E-1, 7.389834E-1, 7.418355E-1, 7.418357E-1, 7.494228E-1, 7.494230E-1, 7.500000E-1, 7.709370E-1, 7.709372E-1, 8.100588E-1, 8.100590E-1, 8.120604E-1, 8.120606E-1, 8.179152E-1, 8.179154E-1, 8.426150E-1, 8.426152E-1, 8.750000E-1, 8.848368E-1, 8.848370E-1, 8.869677E-1, 8.869679E-1, 8.885176E-1, 8.885178E-1, 8.895932E-1, 8.895934E-1, 9.174787E-1, 9.174789E-1, 9.634243E-1, 9.634245E-1, 9.644569E-1, 9.644571E-1, 9.955281E-1, 9.955283E-1, 1.000000E0, 1.024999E0, 1.025000E0, 1.025001E0, 2.000000E7 };
      REQUIRE( ranges::equal(finalE,correct_finalE,equal) );
      //REQUIRE( ranges::equal(finalXS,correct_finalXS,equal) );
      //std::cout << finalE.size() << std::endl;
      //std::cout << correct_finalE.size() << std::endl;
      for ( size_t i = 0; i < finalE.size(); ++i ){
          //std::cout << finalE[i] << "      " << finalXS[i] << std::endl;
       //std::cout << i << "   " << finalE[i] << "  " << correct_finalE[i] << "    " << finalXS[i] << "   " << correct_finalXS[i] << std::endl;
         // std::cout << finalE[i] << "   " << correct_finalE[i] << std::endl;
       // REQUIRE( finalXS[i] == Approx(correct_finalXS[i]).epsilon(1e-6) );
      }


      
      REQUIRE( true );
      
    } // WHEN
  } // GIVEN
} // TEST CASE
